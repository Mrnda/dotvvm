function basicAuthenticatedFetch(e,t){var r=sessionStorage.getItem("someAuth");return null!=r&&(null==t&&(t={}),null==t.headers&&(t.headers={}),null==t.headers.Authorization&&(t.headers.Authorization="Basic "+btoa(r))),null==t&&(t={}),t.cache||(t.cache="no-cache"),window.fetch(e,t).then(function(n){return 401===n.status&&null==r?(null==sessionStorage.getItem("someAuth")&&function(){var t=prompt("You credentials for "+(e.url||e))||"";sessionStorage.setItem("someAuth",t)}(),basicAuthenticatedFetch(e,t)):n})}var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();!function(){if("undefined"==typeof Promise||!self.fetch){var e=document.createElement("script");e.src=window.dotvvm__polyfillUrl,e.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(e)}}();var DotvvmDomUtils=function(){function e(){}return e.prototype.onDocumentReady=function(e){/in/.test(document.readyState)?setTimeout("dotvvm.domUtils.onDocumentReady("+e+")",9):e()},e.prototype.attachEvent=function(e,t,r,n){void 0===n&&(n=!1),e.addEventListener?e.addEventListener(t,r,n):e.attachEvent("on"+t,r)},e}(),HistoryRecord=function(){return function(e,t){this.navigationType=e,this.url=t}}(),DotvvmSpaHistory=function(){function e(){}return e.prototype.pushPage=function(e){history.pushState(new HistoryRecord("SPA",e),"",e)},e.prototype.replacePage=function(e){history.replaceState(new HistoryRecord("SPA",e),"",e)},e.prototype.isSpaPage=function(e){return e&&"SPA"==e.navigationType},e.prototype.getHistoryRecord=function(e){return e},e}(),DotvvmEvents=function(){return function(){this.init=new DotvvmEvent("dotvvm.events.init",!0),this.beforePostback=new DotvvmEvent("dotvvm.events.beforePostback"),this.afterPostback=new DotvvmEvent("dotvvm.events.afterPostback"),this.error=new DotvvmEvent("dotvvm.events.error"),this.spaNavigating=new DotvvmEvent("dotvvm.events.spaNavigating"),this.spaNavigated=new DotvvmEvent("dotvvm.events.spaNavigated"),this.redirect=new DotvvmEvent("dotvvm.events.redirect"),this.postbackHandlersStarted=new DotvvmEvent("dotvvm.events.postbackHandlersStarted"),this.postbackHandlersCompleted=new DotvvmEvent("dotvvm.events.postbackHandlersCompleted"),this.postbackResponseReceived=new DotvvmEvent("dotvvm.events.postbackResponseReceived"),this.postbackCommitInvoked=new DotvvmEvent("dotvvm.events.postbackCommitInvoked"),this.postbackViewModelUpdated=new DotvvmEvent("dotvvm.events.postbackViewModelUpdated"),this.postbackRejected=new DotvvmEvent("dotvvm.events.postbackRejected"),this.staticCommandMethodInvoking=new DotvvmEvent("dotvvm.events.staticCommandMethodInvoking"),this.staticCommandMethodInvoked=new DotvvmEvent("dotvvm.events.staticCommandMethodInvoked"),this.staticCommandMethodFailed=new DotvvmEvent("dotvvm.events.staticCommandMethodInvoked")}}(),DotvvmEvent=function(){function e(e,t){void 0===t&&(t=!1),this.name=e,this.triggerMissedEventsOnSubscribe=t,this.handlers=[],this.history=[]}return e.prototype.subscribe=function(e){if(this.handlers.push(e),this.triggerMissedEventsOnSubscribe)for(var t=0;t<this.history.length;t++)e(history[t])},e.prototype.unsubscribe=function(e){var t=this.handlers.indexOf(e);t>=0&&(this.handlers=this.handlers.splice(t,1))},e.prototype.trigger=function(e){for(var t=0;t<this.handlers.length;t++)this.handlers[t](e);this.triggerMissedEventsOnSubscribe&&this.history.push(e)},e}(),DotvvmErrorEventArgs=function(){return function(e,t,r,n,o,a,i){void 0===a&&(a=void 0),void 0===i&&(i=!1),this.sender=e,this.viewModel=t,this.viewModelName=r,this.xhr=n,this.postbackClientId=o,this.serverResponseObject=a,this.isSpaNavigationError=i,this.handled=!1}}(),DotvvmBeforePostBackEventArgs=function(){return function(e,t,r,n){this.sender=e,this.viewModel=t,this.viewModelName=r,this.postbackClientId=n,this.cancel=!1,this.clientValidationFailed=!1}}(),DotvvmAfterPostBackEventArgs=function(){function e(e,t,r,n){void 0===r&&(r=null),this.postbackOptions=e,this.serverResponseObject=t,this.commandResult=r,this.xhr=n,this.isHandled=!1,this.wasInterrupted=!1}return Object.defineProperty(e.prototype,"postbackClientId",{get:function(){return this.postbackOptions.postbackId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewModelName",{get:function(){return this.postbackOptions.viewModelName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewModel",{get:function(){return this.postbackOptions.viewModel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sender",{get:function(){return this.postbackOptions.sender},enumerable:!0,configurable:!0}),e}(),DotvvmSpaNavigatingEventArgs=function(){return function(e,t,r){this.viewModel=e,this.viewModelName=t,this.newUrl=r,this.cancel=!1}}(),DotvvmSpaNavigatedEventArgs=function(){return function(e,t,r,n){this.viewModel=e,this.viewModelName=t,this.serverResponseObject=r,this.xhr=n,this.isHandled=!1}}(),DotvvmRedirectEventArgs=function(){return function(e,t,r,n){this.viewModel=e,this.viewModelName=t,this.url=r,this.replace=n,this.isHandled=!1}}(),DotvvmFileUpload=function(){function e(){}return e.prototype.showUploadDialog=function(e){var t=this.getIframe(e);this.createUploadId(e,t),this.openUploadDialog(t)},e.prototype.getIframe=function(e){return e.parentElement.previousSibling},e.prototype.openUploadDialog=function(e){e.contentWindow.document.getElementById("upload").click()},e.prototype.createUploadId=function(e,t){t=t||this.getIframe(e);var r="DotVVM_upl"+(new Date).getTime().toString();e.parentElement.parentElement.setAttribute("data-dotvvm-upload-id",r),t.setAttribute("data-dotvvm-upload-id",r)},e.prototype.reportProgress=function(e,t,r,n){var o=document.querySelector("div[data-dotvvm-upload-id='"+e.value+"']"),a=ko.dataFor(o.firstChild);if("string"==typeof n)a.Error(n);else{a.Error("");for(var i=0;i<n.length;i++)a.Files.push(dotvvm.serialization.wrapObservable(dotvvm.serialization.deserialize(n[i])));(o.attributes["data-dotvvm-upload-completed"]||{value:null}).value&&new Function(o.attributes["data-dotvvm-upload-completed"].value).call(o)}a.Progress(r),a.IsBusy(t)},e}(),DotvvmFileUploadCollection=function(){return function(){this.Files=ko.observableArray(),this.Progress=ko.observable(0),this.Error=ko.observable(),this.IsBusy=ko.observable()}}(),DotvvmFileUploadData=function(){return function(){this.FileId=ko.observable(),this.FileName=ko.observable(),this.FileSize=ko.observable(),this.IsFileTypeAllowed=ko.observable(),this.IsMaxSizeExceeded=ko.observable(),this.IsAllowed=ko.observable()}}(),DotvvmFileSize=function(){return function(){this.Bytes=ko.observable(),this.FormattedText=ko.observable()}}(),DotvvmGlobalize=function(){function e(){}return e.prototype.format=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e.replace(/\{([1-9]?[0-9]+)(:[^}]+)?\}/g,function(e,n,o){var a=r[parseInt(n)];return o?t.formatString(o,a):a})},e.prototype.formatString=function(e,t){return null==(t=ko.unwrap(t))?"":("string"==typeof t&&(t=this.parseDotvvmDate(t)),""!==e&&null!==e||(e="G"),dotvvm_Globalize.format(t,e,dotvvm.culture))},e.prototype.parseDotvvmDate=function(e){var t=e.match("^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(\\.[0-9]{3,7})$");return t?new Date(parseInt(t[1]),parseInt(t[2])-1,parseInt(t[3]),parseInt(t[4]),parseInt(t[5]),parseInt(t[6]),t.length>7?parseInt(t[7].substring(1,4)):0):null},e.prototype.parseNumber=function(e){return dotvvm_Globalize.parseFloat(e,10,dotvvm.culture)},e.prototype.parseDate=function(e,t,r){return dotvvm_Globalize.parseDate(e,t,dotvvm.culture,r)},e.prototype.bindingDateToString=function(e,t){var r=this;if(void 0===t&&(t="G"),!e)return"";var n=function(){var t=ko.unwrap(e);return"string"==typeof t?r.parseDotvvmDate(t):t},o=function(){var e=n();return null!=e?dotvvm_Globalize.format(e,t,dotvvm.culture):""};if(ko.isWriteableObservable(e)){var a="string"==typeof n()?function(t){return e(null==t?null:dotvvm.serialization.serializeDate(t,!1))}:e;return ko.pureComputed({read:function(){return o()},write:function(e){return a(dotvvm_Globalize.parseDate(e,t,dotvvm.culture))}})}return ko.pureComputed(function(){return o()})},e.prototype.bindingNumberToString=function(e,t){var r=this;if(void 0===t&&(t="G"),!e)return"";var n=function(){var n=function(){var t=ko.unwrap(e);return"string"==typeof t?r.parseNumber(t):t}();return null!=n?dotvvm_Globalize.format(n,t,dotvvm.culture):""};return ko.isWriteableObservable(e)?ko.pureComputed({read:function(){return n()},write:function(t){var r=dotvvm_Globalize.parseFloat(t,10,dotvvm.culture),n=null==t||null!=r&&!isNaN(r);e(n?r:null)}}):ko.pureComputed(function(){return n()})},e}(),PostbackOptions=function(){return function(e,t,r,n,o){void 0===r&&(r=[]),this.postbackId=e,this.sender=t,this.args=r,this.viewModel=n,this.viewModelName=o,this.additionalPostbackData={}}}(),ConfirmPostBackHandler=function(){function e(e){this.message=e}return e.prototype.execute=function(e,t){var r=this;return new Promise(function(t,n){confirm(r.message)?e().then(t,n):n({type:"handler",handler:r,message:"The postback was not confirmed"})})},e}(),SuppressPostBackHandler=function(){function e(e){this.suppress=e}return e.prototype.execute=function(e,t){var r=this;return new Promise(function(t,n){r.suppress?n({type:"handler",handler:r,message:"The postback was suppressed"}):e().then(t,n)})},e}(),DotvvmSerialization=function(){function DotvvmSerialization(){}return DotvvmSerialization.prototype.deserialize=function(viewModel,target,deserializeAll){if(void 0===deserializeAll&&(deserializeAll=!1),void 0===viewModel||null==viewModel)return ko.isObservable(target)&&target(viewModel),viewModel;if("string"==typeof viewModel||"number"==typeof viewModel||"boolean"==typeof viewModel)return ko.isObservable(target)&&target(viewModel),viewModel;if(viewModel instanceof Date)return viewModel=dotvvm.serialization.serializeDate(viewModel),ko.isObservable(target)&&target(viewModel),viewModel;if(viewModel instanceof Array){if(ko.isObservable(target)&&"removeAll"in target&&null!=target()&&target().length===viewModel.length)for(var targetArray=target(),i=0;i<viewModel.length;i++){var targetItem=targetArray[i](),deserialized=this.deserialize(viewModel[i],targetItem,deserializeAll);targetItem!==deserialized&&targetArray[i](deserialized)}else{for(var array=[],i=0;i<viewModel.length;i++)array.push(this.wrapObservable(this.deserialize(viewModel[i],{},deserializeAll)));ko.isObservable(target)?("removeAll"in target||(ko.utils.extend(target,ko.observableArray.fn),target=target.extend({trackArrayChanges:!0})),target(array)):target=ko.observableArray(array)}return target}void 0===target&&(target={});var result=ko.unwrap(target),updateTarget=!1;null!=result&&0===Object.keys(result).length&&result.constructor===Object&&void 0!==viewModel.$class&&(result=eval("new "+viewModel.$class+"()"),ko.isObservable(target)?updateTarget=!0:target=result),null==result&&(result={},ko.isObservable(target)?updateTarget=!0:target=result);for(var prop in viewModel)if(viewModel.hasOwnProperty(prop)&&!/\$options$/.test(prop)){var value=viewModel[prop];if(void 0===value)continue;if(!ko.isObservable(value)&&"function"==typeof value)continue;var options=viewModel[prop+"$options"];if(!deserializeAll&&options&&options.doNotUpdate)continue;var deserialized=ko.isObservable(value)?value:this.deserialize(value,result[prop],deserializeAll);if(value instanceof Date&&(result[prop+"$options"]=result[prop+"$options"]||{},result[prop+"$options"].isDate=!0),ko.isObservable(deserialized))if(ko.isObservable(result[prop]))deserialized()!==result[prop]()&&result[prop](deserialized());else{var unwrapped=ko.unwrap(deserialized);result[prop]=Array.isArray(unwrapped)?ko.observableArray(unwrapped):ko.observable(unwrapped)}else ko.isObservable(result[prop])?deserialized!==result[prop]()&&result[prop](deserialized):result[prop]=ko.observable(deserialized);if(options&&options.clientExtenders&&ko.isObservable(result[prop]))for(var j=0;j<options.clientExtenders.length;j++){var extenderOptions={},extenderInfo=options.clientExtenders[j];extenderOptions[extenderInfo.name]=extenderInfo.parameter,result[prop].extend(extenderOptions)}}for(var prop in viewModel)if(viewModel.hasOwnProperty(prop)&&/\$options$/.test(prop)){result[prop]=result[prop]||{};for(var optProp in viewModel[prop])viewModel[prop].hasOwnProperty(optProp)&&(result[prop][optProp]=viewModel[prop][optProp]);var originalName=prop.substring(0,prop.length-"$options".length);void 0===result[originalName]&&(result[originalName]=ko.observable())}return updateTarget&&target(result),target},DotvvmSerialization.prototype.wrapObservable=function(e){return ko.isObservable(e)?e:ko.observable(e)},DotvvmSerialization.prototype.serialize=function(e,t){if(void 0===t&&(t={}),(t=ko.utils.extend({},t)).pathOnly&&t.path&&0===t.path.length&&(t.pathOnly=!1),null==e)return null;if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return e;if(ko.isObservable(e))return this.serialize(e(),t);if("function"==typeof e)return null;if(e instanceof Array){if(t.pathOnly&&t.path){var r=parseInt(t.path.pop());return(n=new Array(r+1))[r]=this.serialize(e[r],t),t.path.push(r.toString()),n}for(var n=[],o=0;o<e.length;o++)n.push(this.serialize(e[o],t));return n}if(e instanceof Date)return t.restApiTarget?e:this.serializeDate(e);var a=t.path&&t.path.pop(),i={};for(var s in e)if(e.hasOwnProperty(s)){if(t.pathOnly&&s!==a)continue;var l=e[s];if(t.ignoreSpecialProperties&&"$"===s[0])continue;if(!t.serializeAll&&(/\$options$/.test(s)||"$validationErrors"===s))continue;if(void 0===l)continue;if(!ko.isObservable(l)&&"function"==typeof l)continue;var u=e[s+"$options"];if(!t.serializeAll&&u&&u.doNotPost);else if(t.oneLevel)i[s]=ko.unwrap(l);else if(!t.serializeAll&&u&&u.pathOnly&&t.pathMatcher){var d=u.pathOnly;d instanceof Array||(d=t.path||this.findObject(l,t.pathMatcher)),d&&(0===d.length?i[s]=this.serialize(l,t):i[s]=this.serialize(l,{ignoreSpecialProperties:t.ignoreSpecialProperties,serializeAll:t.serializeAll,path:d,pathOnly:!0}))}else i[s]=this.serialize(l,t);u&&u.type&&!this.validateType(i[s],u.type)&&(delete i[s],u.wasInvalid=!0)}return a&&t.path&&t.path.push(a),i},DotvvmSerialization.prototype.validateType=function(e,t){var r="?"===t[t.length-1];if(r&&(t=t.substr(0,t.length-1)),r&&(null==e||""==e))return!0;if(!r&&(null===e||void 0===e))return!1;var n=/(u?)int(\d*)/.exec(t);if(n){if(!/^-?\d*$/.test(e))return!1;var o="u"===n[1],a=parseInt(n[2]),i=0,s=Math.pow(2,a)-1;o||(s+=i=-Math.floor(s/2));var l=parseInt(e);return l>=i&&l<=s&&l===parseFloat(e)}return"number"!==t&&"single"!==t&&"double"!==t&&"decimal"!==t||(+e===e||!isNaN(+e)&&"string"==typeof e)},DotvvmSerialization.prototype.findObject=function(e,t){if(t(e))return[];if(e=ko.unwrap(e),t(e))return[];if("object"!=typeof e)return null;for(var r in e)if(e.hasOwnProperty(r)){var n=this.findObject(e[r],t);if(n)return n.push(r),n}return null},DotvvmSerialization.prototype.flatSerialize=function(e){return this.serialize(e,{ignoreSpecialProperties:!0,oneLevel:!0,serializeAll:!0})},DotvvmSerialization.prototype.getPureObject=function(e){if((e=ko.unwrap(e))instanceof Array)return e.map(this.getPureObject.bind(this));var t={};for(var r in e)"$"!=r[0]&&(t[r]=e[r]);return t},DotvvmSerialization.prototype.pad=function(e,t){for(;e.length<t;)e="0"+e;return e},DotvvmSerialization.prototype.serializeDate=function(e,t){if(void 0===t&&(t=!0),null==e)return null;if("string"==typeof e)return null==dotvvm.globalize.parseDotvvmDate(e)&&console.error(new Error("Date "+e+" is invalid.")),e;var r=new Date(e.getTime());t?r.setMinutes(e.getMinutes()+e.getTimezoneOffset()):r=e;return this.pad(r.getFullYear().toString(),4)+"-"+this.pad((r.getMonth()+1).toString(),2)+"-"+this.pad(r.getDate().toString(),2)+"T"+this.pad(r.getHours().toString(),2)+":"+this.pad(r.getMinutes().toString(),2)+":"+this.pad(r.getSeconds().toString(),2)+"."+this.pad(r.getMilliseconds().toString(),3)+"0000"},DotvvmSerialization}();document.getElementByDotvvmId=function(e){return document.querySelector("[data-dotvvm-id='"+e+"']")};var DotVVM=function(){function e(){var e=this;this.postBackCounter=0,this.lastStartedPostack=0,this.resourceSigns={},this.isViewModelUpdating=!0,this.spaHistory=new DotvvmSpaHistory,this.viewModelObservables={},this.isSpaReady=ko.observable(!1),this.viewModels={},this.serialization=new DotvvmSerialization,this.postbackHandlers={confirm:function(e){return new ConfirmPostBackHandler(e.message)},suppress:function(e){return new SuppressPostBackHandler(e.suppress)},timeout:function(t){return t.time?e.createWindowSetTimeoutHandler(t.time):e.windowSetTimeoutHandler},"concurrency-default":function(t){return{name:"concurrency-default",before:["setIsPostbackRunning"],execute:function(r,n){return e.commonConcurrencyHandler(r(),n,t.q||"default")}}},"concurrency-deny":function(e){return{name:"concurrency-deny",before:["setIsPostbackRunning"],execute:function(t,r){var n=e.q||"default";return dotvvm.getPostbackQueue(n).noRunning>0?Promise.reject({type:"handler",handler:this,message:"An postback is already running"}):dotvvm.commonConcurrencyHandler(t(),r,n)}}},"concurrency-queue":function(e){return{name:"concurrency-queue",before:["setIsPostbackRunning"],execute:function(t,r){var n=e.q||"default",o=function(){return dotvvm.commonConcurrencyHandler(t(),r,n)};return dotvvm.getPostbackQueue(n).noRunning>0?new Promise(function(e){dotvvm.getPostbackQueue(n).queue.push(function(){return e(o())})}):o()}}},suppressOnUpdating:function(e){return{name:"suppressOnUpdating",before:["setIsPostbackRunning","concurrency-default","concurrency-queue","concurrency-deny"],execute:function(e,t){return dotvvm.isViewModelUpdating?Promise.reject({type:"handler",handler:this,message:"ViewModel is updating, so it's probably false onchange event"}):e()}}}},this.suppressOnDisabledElementHandler={name:"suppressOnDisabledElement",before:["setIsPostbackRunning","concurrency-default","concurrency-queue","concurrency-deny"],execute:function(t,r){return r.sender&&dotvvm.isPostBackProhibited(r.sender)?Promise.reject({type:"handler",handler:e,message:"PostBack is prohitibited on disabled element"}):t()}},this.beforePostbackEventPostbackHandler={execute:function(t,r){var n=new DotvvmBeforePostBackEventArgs(r.sender,r.viewModel,r.viewModelName,r.postbackId);return e.events.beforePostback.trigger(n),n.cancel?Promise.reject({type:"event",options:r}):t()}},this.isPostBackRunningHandler=function(){var t=0;return{name:"setIsPostbackRunning",before:["eventInvoke-postbackHandlersStarted"],execute:function(r,n){e.isPostbackRunning(!0),t++;var o=r();return o.then(function(){return e.isPostbackRunning(!!--t)},function(){return e.isPostbackRunning(!!--t)}),o}}}(),this.windowSetTimeoutHandler=this.createWindowSetTimeoutHandler(0),this.commonConcurrencyHandler=function(t,r,n){var o=e.getPostbackQueue(n);o.noRunning++;var a=function(){if(o.noRunning--,o.queue.length>0){var e=o.queue.shift();window.setTimeout(e,0)}};return t.then(function(t){var n=e.lastStartedPostack==r.postbackId?t:function(){return Promise.reject(null)};return function(){var e=n();return e.then(a,a),e}},function(e){return a(),Promise.reject(e)})},this.defaultConcurrencyPostbackHandler=this.postbackHandlers["concurrency-default"]({}),this.postbackQueues={},this.postbackHandlersStartedEventHandler={name:"eventInvoke-postbackHandlersStarted",execute:function(e,t){return dotvvm.events.postbackHandlersStarted.trigger(t),e()}},this.postbackHandlersCompletedEventHandler={name:"eventInvoke-postbackHandlersCompleted",after:["eventInvoke-postbackHandlersStarted"],execute:function(e,t){return dotvvm.events.postbackHandlersCompleted.trigger(t),e()}},this.globalPostbackHandlers=[this.suppressOnDisabledElementHandler,this.isPostBackRunningHandler,this.postbackHandlersStartedEventHandler],this.globalLaterPostbackHandlers=[this.postbackHandlersCompletedEventHandler,this.beforePostbackEventPostbackHandler],this.events=new DotvvmEvents,this.globalize=new DotvvmGlobalize,this.evaluator=new DotvvmEvaluator,this.domUtils=new DotvvmDomUtils,this.fileUpload=new DotvvmFileUpload,this.extensions={},this.isPostbackRunning=ko.observable(!1)}return e.prototype.createWindowSetTimeoutHandler=function(e){return{name:"timeout",before:["eventInvoke-postbackHandlersStarted","setIsPostbackRunning"],execute:function(t,r){return new Promise(function(t,r){return window.setTimeout(t,e)}).then(function(){return t()})}}},e.prototype.getPostbackQueue=function(e){return void 0===e&&(e="default"),this.postbackQueues[e]||(this.postbackQueues[e]={queue:[],noRunning:0}),this.postbackQueues[e]},e.prototype.init=function(e,t){var r=this;this.addKnockoutBindingHandlers();var n=this.viewModels[e]=JSON.parse(document.getElementById("__dot_viewmodel_"+e).value);if(n.resources)for(var o in n.resources)this.resourceSigns[o]=!0;n.renderedResources&&n.renderedResources.forEach(function(e){return r.resourceSigns[e]=!0});var a=n.resultIdFragment,i=n.viewModel=this.serialization.deserialize(this.viewModels[e].viewModel,{},!0);this.culture=t,this.validation=new DotvvmValidation(this),this.viewModelObservables[e]=ko.observable(i),ko.applyBindings(this.viewModelObservables[e],document.documentElement),this.events.init.trigger({viewModel:i});var s=this.getSpaPlaceHolder();if(null!=s){var l=function(t){return r.handleHashChange(e,s,t)};this.useHistoryApiSpaNavigation=JSON.parse(s.getAttribute("data-dotvvm-spacontentplaceholder-usehistoryapi")),this.useHistoryApiSpaNavigation&&(l=function(t){return r.handleHashChangeWithHistory(e,s,t)});this.domUtils.attachEvent(window,"hashchange",function(){return l(!1)}),l(!0)}if(window.addEventListener("popstate",function(t){return r.handlePopState(e,t,null!=s)}),this.isViewModelUpdating=!1,a)if(s){var u=document.getElementById(a);u&&"function"==typeof u.scrollIntoView&&u.scrollIntoView(!0)}else location.hash=a;this.domUtils.attachEvent(window,"beforeunload",function(t){r.persistViewModel(e)})},e.prototype.handlePopState=function(e,t,r){if(this.spaHistory.isSpaPage(t.state)){var n=this.spaHistory.getHistoryRecord(t.state);r?this.navigateCore(e,n.url):this.performRedirect(n.url,!0),t.preventDefault()}},e.prototype.handleHashChangeWithHistory=function(e,t,r){var n=this;if(0===document.location.hash.indexOf("#!/"))this.navigateCore(e,document.location.hash.substring(2),function(e){n.spaHistory.replacePage(e)});else{var o=t.getAttribute("data-dotvvm-spacontentplaceholder-defaultroute");if(!t.hasAttribute("data-dotvvm-spacontentplaceholder-content")&&o)this.navigateCore(e,"/"+o,function(e){return n.spaHistory.replacePage(e)});else{this.isSpaReady(!0),t.style.display="";var a=location.pathname+location.search+location.hash;this.spaHistory.replacePage(a)}}},e.prototype.handleHashChange=function(e,t,r){if(0===document.location.hash.indexOf("#!/"))this.navigateCore(e,document.location.hash.substring(2));else{var n=t.getAttribute("data-dotvvm-spacontentplaceholder-defaultroute");if(n)n="#!/"+n,n=this.fixSpaUrlPrefix(n),this.performRedirect(n,r);else if(r)this.isSpaReady(!0),t.style.display="";else{var o=(n=document.location.toString()).indexOf("/","https://".length);n=o>0?n.substring(o):"/",this.navigateCore(e,n)}}},e.prototype.persistViewModel=function(e){var t=this.viewModels[e],r={};for(var n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);r.viewModel=this.serialization.serialize(r.viewModel,{serializeAll:!0}),document.getElementById("__dot_viewmodel_"+e).value=JSON.stringify(r)},e.prototype.backUpPostBackConter=function(){return++this.postBackCounter},e.prototype.isPostBackStillActive=function(e){return this.postBackCounter===e},e.prototype.staticCommandPostback=function(e,t,r,n,o,a){var i=this;void 0===o&&(o=function(e){}),void 0===a&&(a=function(e,t){});var s=this.serialization.serialize({args:n,command:r,$csrfToken:this.viewModels[e].viewModel.$csrfToken});dotvvm.events.staticCommandMethodInvoking.trigger(s),this.postJSON(this.viewModels[e].url,"POST",ko.toJSON(s),function(e){try{i.isViewModelUpdating=!0;var t=JSON.parse(e.responseText);dotvvm.events.staticCommandMethodInvoked.trigger(__assign({},s,{result:t,xhr:e})),o(t)}catch(t){dotvvm.events.staticCommandMethodFailed.trigger(__assign({},s,{xhr:e,error:t})),a(e,t)}finally{i.isViewModelUpdating=!1}},function(r){i.events.error.trigger(new DotvvmErrorEventArgs(t,i.viewModels[e].viewModel,e,r,null)),console.warn("StaticCommand postback failed: "+r.status+" - "+r.statusText,r),a(r),dotvvm.events.staticCommandMethodFailed.trigger(__assign({},s,{xhr:r}))},function(e){e.setRequestHeader("X-PostbackType","StaticCommand")})},e.prototype.processPassedId=function(e,t){if("string"==typeof e||null==e)return e;if("object"==typeof e&&e.expr)return this.evaluator.evaluateOnViewModel(t,e.expr);throw new Error("invalid argument")},e.prototype.getPostbackHandler=function(e){var t=this.postbackHandlers[e];if(t)return t;throw new Error("Could not find postback handler of name '"+e+"'")},e.prototype.isPostbackHandler=function(e){return e&&"function"==typeof e.execute},e.prototype.findPostbackHandlers=function(e,t){var r=this,n=function(e,t){return!1===t.enabled?null:r.getPostbackHandler(e)(t)};return t.map(function(t){return"string"==typeof t?n(t,{}):r.isPostbackHandler(t)?t:t instanceof Array?function(){var r=t[0],o=t[1];return n(r,"function"==typeof o?o(e,e.$data):o)}():n(t.name,t.options&&t.options(e))}).filter(function(e){return null!=e})},e.prototype.sortHandlers=function(e){for(var t=function(){for(var t={},r=0,n=e;r<n.length;r++){var o=n[r];null!=o.name&&(t[o.name]=o)}return function(e){return"string"==typeof e?t[e]:e}}(),r=e.map(function(e,r){return e["@sort_index"]=r,{handler:e,deps:(e.after||[]).map(t)}}),n=0,o=e;n<o.length;n++){var a=o[n];if(a.before)for(var i=0,s=a.before.map(t);i<s.length;i++){var l=s[i];if(l){var u=l["@sort_index"];r[u].deps.push(a)}}}for(var d=[],v=new Uint8Array(r.length),c=function(e){switch(v[e]){case 0:break;case 1:throw new Error("Cyclic PostbackHandler dependency found.");case 2:return;default:throw new Error("")}if(1!=v[e]){v[e]=1;for(var t=r[e],n=t.handler,o=0,a=t.deps;o<a.length;o++){var i=a[o];c(i["@sort_index"])}v[e]=2,d.push(n)}},p=0;p<r.length;p++)c(p);return d},e.prototype.applyPostbackHandlersCore=function(e,t,r){var n=function(e){return"function"==typeof e?e:function(){return Promise.resolve(new DotvvmAfterPostBackEventArgs(t,null,e))}};if(null==r||0===r.length)return e(t).then(n,function(e){return Promise.reject(e)});return this.sortHandlers(r).reduceRight(function(e,r,n){return function(){return r.execute(e,t)}},function(){return e(t).then(n,function(e){return Promise.reject(e)})})()},e.prototype.applyPostbackHandlers=function(e,t,r,n,o,a,i){void 0===n&&(n=[]),void 0===o&&(o=ko.contextFor(t)),void 0===a&&(a=o.$root);var s=new PostbackOptions(this.backUpPostBackConter(),t,n,a,i),l=this.applyPostbackHandlersCore(e,s,this.findPostbackHandlers(o,this.globalPostbackHandlers.concat(r||[]).concat(this.globalLaterPostbackHandlers))).then(function(e){return e()},function(e){return Promise.reject(e)});return l.catch(function(e){e&&console.log("Rejected: "+e)}),l},e.prototype.postbackCore=function(e,t,r,n,o,a){var i=this;return new Promise(function(s,l){var u=e.viewModelName,d=i.viewModels[u].viewModel;i.lastStartedPostack=e.postbackId,i.updateDynamicPathFragments(o,t);var v={viewModel:i.serialization.serialize(d,{pathMatcher:function(e){return o&&e==o.$data}}),currentPath:t,command:r,controlUniqueId:i.processPassedId(n,o),additionalData:e.additionalPostbackData,renderedResources:i.viewModels[u].renderedResources,commandArgs:a};i.postJSON(i.viewModels[u].url,"POST",ko.toJSON(v),function(t){dotvvm.events.postbackResponseReceived.trigger({}),s(function(){return new Promise(function(r,n){dotvvm.events.postbackCommitInvoked.trigger({});var o=t.getResponseHeader("Location"),a=null!=o&&o.length>0?{action:"redirect",url:o}:JSON.parse(t.responseText);!a.viewModel&&a.viewModelDiff&&(a.viewModel=i.patch(v.viewModel,a.viewModelDiff)),i.loadResourceList(a.resources,function(){var o=!1;if("successfulCommand"===a.action){try{i.isViewModelUpdating=!0;var s=i.cleanUpdatedControls(a);a.viewModel&&(ko.delaySync.pause(),i.serialization.deserialize(a.viewModel,i.viewModels[u].viewModel),ko.delaySync.resume()),o=!0,i.cleanUpdatedControls(a,s),i.restoreUpdatedControls(a,s,!0)}finally{i.isViewModelUpdating=!1}dotvvm.events.postbackViewModelUpdated.trigger({})}else if("redirect"===a.action)return i.handleRedirect(a,u),r();var l=a.resultIdFragment;if(l)if(i.getSpaPlaceHolder()||location.hash=="#"+l){var v=document.getElementById(l);v&&"function"==typeof v.scrollIntoView&&v.scrollIntoView(!0)}else location.hash=l;if(o){var c=new DotvvmAfterPostBackEventArgs(e,a,a.commandResult,t);r(c)}else n(new DotvvmErrorEventArgs(e.sender,d,u,t,e.postbackId,a))})})})},function(t){l({type:"network",options:e,args:new DotvvmErrorEventArgs(e.sender,d,u,t,e.postbackId)})})})},e.prototype.handleSpaNavigation=function(e){return"_blank"==e.getAttribute("target")||this.handleSpaNavigationCore(e.getAttribute("href"))},e.prototype.handleSpaNavigationCore=function(e){var t=this;if(e&&0===e.indexOf("/")){return e=this.removeVirtualDirectoryFromUrl(e,"root"),this.navigateCore("root",e,function(e){history.state&&history.state.url==e||t.spaHistory.pushPage(e)}),!1}return!0},e.prototype.postBack=function(e,t,r,n,o,a,i,s){var l=this;a=a||ko.contextFor(t);var u=this.findPostbackHandlers(a,this.globalPostbackHandlers.concat(i||[]).concat(this.globalLaterPostbackHandlers));0==u.filter(function(e){return e.name&&0==e.name.indexOf("concurrency-")}).length&&u.push(this.defaultConcurrencyPostbackHandler);var d=new PostbackOptions(this.backUpPostBackConter(),t,s,a.$data,e),v=this.applyPostbackHandlersCore(function(e){return l.postbackCore(e,r,n,o,a,s)},d,u).then(function(e){return e().then(function(e){return e},function(e){return Promise.reject({type:"commit",args:e})})},function(e){return Promise.reject(e)});return v.then(function(e){return e&&l.events.afterPostback.trigger(e)},function(e){var t=new DotvvmAfterPostBackEventArgs(d,"commit"==e.type&&e.args?e.args.serverResponseObject:null,d.postbackId);"handler"==e.type||"event"==e.type?(t.wasInterrupted=!0,l.events.postbackRejected.trigger({})):"network"==e.type&&l.events.error.trigger(e.args),l.events.afterPostback.trigger(t)}),v},e.prototype.loadResourceList=function(e,t){var r="";for(var n in e){if(!/^__noname_\d+$/.test(n)){if(this.resourceSigns[n])continue;this.resourceSigns[n]=!0}r+=e[n]+" "}if(""!==r.trim()){var o=document.createElement("div");o.innerHTML=r;for(var a=[],i=0;i<o.children.length;i++)a.push(o.children.item(i));this.loadResourceElements(a,0,t)}else setTimeout(t,4)},e.prototype.loadResourceElements=function(e,t,r){var n=this;if(t>=e.length)r();else{var o=e[t],a=!1;if("script"==o.tagName.toLowerCase()){var i=document.createElement("script");o.src&&(i.src=o.src,a=!0),o.type&&(i.type=o.type),o.text&&(i.text=o.text),o=i}else if("link"==o.tagName.toLowerCase()){var s=document.createElement("link");o.href&&(s.href=o.href),o.rel&&(s.rel=o.rel),o.type&&(s.type=o.type),o=s}a&&(o.onload=function(){return n.loadResourceElements(e,t+1,r)}),document.head.appendChild(o),a||this.loadResourceElements(e,t+1,r)}},e.prototype.getSpaPlaceHolder=function(){var e=document.getElementsByName("__dot_SpaContentPlaceHolder");return 1==e.length?e[0]:null},e.prototype.navigateCore=function(e,t,r){var n=this,o=this.viewModels[e].viewModel,a=this.backUpPostBackConter(),i=new DotvvmSpaNavigatingEventArgs(o,e,t);if(this.events.spaNavigating.trigger(i),!i.cancel){var s=this.viewModels[e].virtualDirectory||"",l="/___dotvvm-spa___"+this.addLeadingSlash(t),u=this.addLeadingSlash(this.concatUrl(s,l)),d=this.getSpaPlaceHolder();if(d){r&&r(this.addLeadingSlash(this.concatUrl(s,this.addLeadingSlash(t))));var v=d.attributes["data-dotvvm-spacontentplaceholder"].value;this.getJSON(u,"GET",v,function(t){if(n.isPostBackStillActive(a)){var r=JSON.parse(t.responseText);n.loadResourceList(r.resources,function(){var a=!1;if("successfulCommand"!==r.action&&r.action){if("redirect"===r.action)return void n.handleRedirect(r,e,!0)}else try{n.isViewModelUpdating=!0;var i=n.cleanUpdatedControls(r);n.viewModels[e]={};for(var s in r)r.hasOwnProperty(s)&&(n.viewModels[e][s]=r[s]);ko.delaySync.pause(),n.serialization.deserialize(r.viewModel,n.viewModels[e].viewModel),ko.delaySync.resume(),a=!0,n.viewModelObservables[e](n.viewModels[e].viewModel),n.restoreUpdatedControls(r,i,!0),n.isSpaReady(!0)}finally{n.isViewModelUpdating=!1}var l=new DotvvmSpaNavigatedEventArgs(o,e,r,t);if(n.events.spaNavigated.trigger(l),!a&&!l.isHandled)throw"Invalid response from server!"})}},function(t){if(n.isPostBackStillActive(a)){var r=new DotvvmErrorEventArgs(void 0,o,e,t,-1,void 0,!0);n.events.error.trigger(r),r.handled||alert(t.responseText)}})}else document.location.href=u}},e.prototype.handleRedirect=function(e,t,r){void 0===r&&(r=!1),null!=e.replace&&(r=e.replace);var n;this.getSpaPlaceHolder()&&!this.useHistoryApiSpaNavigation&&e.url.indexOf("//")<0&&e.allowSpa?("#!"===(n="#!"+this.removeVirtualDirectoryFromUrl(e.url,t))&&(n="#!/"),n=this.fixSpaUrlPrefix(n)):n=e.url;var o=new DotvvmRedirectEventArgs(dotvvm.viewModels[t],t,n,r);this.events.redirect.trigger(o),this.performRedirect(n,r,e.allowSpa&&this.useHistoryApiSpaNavigation)},e.prototype.performRedirect=function(e,t,r){if(t)location.replace(e);else if(r)this.handleSpaNavigationCore(e);else{var n=this.fakeRedirectAnchor;n||((n=document.createElement("a")).style.display="none",n.setAttribute("data-dotvvm-fake-id","dotvvm_fake_redirect_anchor_87D7145D_8EA8_47BA_9941_82B75EE88CDB"),document.body.appendChild(n),this.fakeRedirectAnchor=n),n.href=e,n.click()}},e.prototype.fixSpaUrlPrefix=function(e){var t=this.getSpaPlaceHolder().attributes["data-dotvvm-spacontentplaceholder-urlprefix"];if(!t)return e;var r=t.value;return r!==document.location.pathname&&(""===r&&(r="/"),e=r+e),e},e.prototype.removeVirtualDirectoryFromUrl=function(e,t){var r="/"+this.viewModels[t].virtualDirectory;return 0==e.indexOf(r)?this.addLeadingSlash(e.substring(r.length)):e},e.prototype.addLeadingSlash=function(e){return e.length>0&&"/"!=e.substring(0,1)?"/"+e:e},e.prototype.concatUrl=function(e,t){return e.length>0&&"/"==e.substring(e.length-1)&&(e=e.substring(0,e.length-1)),e+this.addLeadingSlash(t)},e.prototype.patch=function(e,t){var r=this;if(e instanceof Array&&t instanceof Array)return t.map(function(t,n){return r.patch(e[n],t)});if(e instanceof Array||t instanceof Array)return t;if("object"!=typeof e||"object"!=typeof t)return t;for(var n in t)null==t[n]?e[n]=null:null==e[n]?e[n]=t[n]:e[n]=this.patch(e[n],t[n]);return e},e.prototype.updateDynamicPathFragments=function(e,t){for(var r=t.length-1;r>=0;r--)t[r].indexOf("[$index]")>=0&&(t[r]=t[r].replace("[$index]","["+e.$index()+"]")),t[r].indexOf("[$indexPath]")>=0&&(t[r]=t[r].replace("[$indexPath]","["+e.$indexPath.map(function(e){return e()}).join("]/[")+"]")),e=e.$parentContext},e.prototype.postJSON=function(e,t,r,n,o,a){void 0===a&&(a=function(e){});var i=this.getXHR();i.open(t,e,!0),i.setRequestHeader("Content-Type","application/json"),i.setRequestHeader("X-DotVVM-PostBack","true"),i.setRequestHeader("X-Requested-With","XMLHttpRequest"),a(i),i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(i.status<400?n(i):o(i))},i.send(r)},e.prototype.getJSON=function(e,t,r,n,o){var a=this.getXHR();a.open(t,e,!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("X-DotVVM-SpaContentPlaceHolder",r),a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&(a.status<400?n(a):o(a))},a.send()},e.prototype.getXHR=function(){return XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP")},e.prototype.cleanUpdatedControls=function(e,t){void 0===t&&(t={});for(var r in e.updatedControls)if(e.updatedControls.hasOwnProperty(r)){var n=document.getElementByDotvvmId(r);if(n){var o=ko.contextFor(n),a=n.nextSibling,i=n.parentNode;ko.removeNode(n),t[r]={control:n,nextSibling:a,parent:i,dataContext:o}}}return t},e.prototype.restoreUpdatedControls=function(e,t,r){var n=this;for(var o in e.updatedControls)if(e.updatedControls.hasOwnProperty(o)){var a=t[o];if(a){var i=document.createElement(t[o].parent.tagName||"div");if(i.innerHTML=e.updatedControls[o],i.childElementCount>1)throw new Error("Postback.Update control can not render more than one element");var s=i.firstElementChild;if(null==s.id)throw new Error("Postback.Update control always has to render id attribute.");s.id!==t[o].control.id&&console.log("Postback.Update control changed id from '"+t[o].control.id+"' to '"+s.id+"'"),i.removeChild(s),a.nextSibling?a.parent.insertBefore(s,a.nextSibling):a.parent.appendChild(s)}}r&&window.setTimeout(function(){try{n.isViewModelUpdating=!0;for(var r in e.updatedControls){var o=document.getElementByDotvvmId(r);o&&ko.applyBindings(t[r].dataContext,o)}}finally{n.isViewModelUpdating=!1}},0)},e.prototype.unwrapArrayExtension=function(e){return ko.unwrap(ko.unwrap(e))},e.prototype.buildRouteUrl=function(e,t){var r=(e="/"+e).replace(/(\/[^\/]*?)\{([^\}]+?)\??(:(.+?))?\}/g,function(e,r,n,o,a){if(!n)return"";var i=ko.unwrap(t[n.toLowerCase()]);return null==i?"":r+i});return 0===r.indexOf("/")?r.substring(1):r},e.prototype.buildUrlSuffix=function(e,t){var r,n;-1!==e.indexOf("#")?(r=e.substring(0,e.indexOf("#")),n=e.substring(e.indexOf("#"))):(r=e,n="");for(var o in t)if(t.hasOwnProperty(o)){if(!o)continue;var a=ko.unwrap(t[o]);if(null==a)continue;r=r.concat(-1!==r.indexOf("?")?"&"+o+"="+a:"?"+o+"="+a)}return r.concat(n)},e.prototype.isPostBackProhibited=function(e){return!!(e&&e.tagName&&["a","input","button"].indexOf(e.tagName.toLowerCase())>-1&&e.getAttribute("disabled"))},e.prototype.addKnockoutBindingHandlers=function(){function e(e,t){void 0===t&&(t=null);var r=ko.pureComputed({read:function(){var t=e();return ko.unwrap(t)},write:function(r){var n=e();ko.isObservable(n)?n(r):console.warn("Attempted to write to readonly property"+(null==t?"":" "+t)+".")}});return r.wrappedProperty=e,r}ko.virtualElements.allowedBindings.dotvvm_withControlProperties=!0,ko.bindingHandlers.dotvvm_withControlProperties={init:function(t,r,n,o,a){if(!a)throw new Error;var i=r();for(var s in i)i[s]=e(function(){return r()[this.prop]}.bind({prop:s}),"'"+s+"' at '"+r.toString()+"'");var l=a.extend({$control:i});return t.innerBindingContext=l,ko.applyBindingsToDescendants(l,t),{controlsDescendantBindings:!0}},update:function(e,t,r,n,o){}},ko.virtualElements.allowedBindings.dotvvm_introduceAlias=!0,ko.bindingHandlers.dotvvm_introduceAlias={init:function(t,r,n,o,a){if(!a)throw new Error;var i=r(),s={};for(var l in i){for(var u=l.split("."),d=s;0<u.length-1;0)d=s[u[0]]||(s[u[0]]={});d[u[u.length-1]]=e(function(){return r()[this.prop]}.bind({prop:l}),"'"+l+"' at '"+r.toString()+"'")}var v=a.extend(s);return t.innerBindingContext=v,ko.applyBindingsToDescendants(v,t),{controlsDescendantBindings:!0}}},ko.virtualElements.allowedBindings.withGridViewDataSet=!0,ko.bindingHandlers.withGridViewDataSet={init:function(e,t,r,n,o){if(!o)throw new Error;var a=t(),i=o.extend({$gridViewDataSet:a});return e.innerBindingContext=i,ko.applyBindingsToDescendants(i,e),{controlsDescendantBindings:!0}},update:function(e,t,r,n,o){}},ko.bindingHandlers.dotvvmEnable={update:function(e,t){var r=ko.utils.unwrapObservable(t());r&&e.disabled?(e.disabled=!1,e.removeAttribute("disabled")):r||e.disabled||(e.disabled=!0,e.setAttribute("disabled","disabled"))}},ko.bindingHandlers["dotvvm-checkbox-updateAfterPostback"]={init:function(e,t,r,n,o){dotvvm.events.afterPostback.subscribe(function(e){var t=r();if(t["dotvvm-checked-pointer"]){var n=t[t["dotvvm-checked-pointer"]];ko.isObservable(n)&&(n.valueHasMutated?n.valueHasMutated():n.notifySubscribers())}})}},ko.bindingHandlers["dotvvm-checked-pointer"]={init:function(e,t,r,n,o){}},ko.bindingHandlers["dotvvm-UpdateProgress-Visible"]={init:function(e,t,r,n,o){e.style.display="none";var a,i=e.getAttribute("data-delay"),s=!1;dotvvm.isPostbackRunning.subscribe(function(t){t?s||(s=!0,null==i?e.style.display="":a=setTimeout(function(t){e.style.display=""},i)):(s=!1,clearTimeout(a),e.style.display="none")})}},ko.bindingHandlers["dotvvm-table-columnvisible"]={init:function(e,t,r,n,o){var a="",i=!0;if(e instanceof HTMLTableCellElement){for(var s=e;!(s instanceof HTMLTableElement);)s=s.parentElement;var l=[].slice.call(s.rows.item(0).cells).indexOf(e);e.dotvvmChangeVisibility=function(e,t,r){if(i!=r){i=r;for(var n=0;n<e.rows.length;n++){var o=e.rows.item(n).cells[t].style;r?o.display=a:(a=o.display||"",o.display="none")}}}.bind(null,s,l)}},update:function(e,t){e.dotvvmChangeVisibility(ko.unwrap(t()))}},ko.bindingHandlers["dotvvm-textbox-text"]={init:function(e,t,r,n,o){var a=t(),i=(r.get("valueUpdate"),new DotvvmValidationElementMetadata);i.element=e,i.dataType=(e.attributes["data-dotvvm-value-type"]||{value:""}).value,i.format=(e.attributes["data-dotvvm-format"]||{value:""}).value;var s=null;ko.isObservable(a)?(a.dotvvmMetadata?(a.dotvvmMetadata.elementsMetadata||(a.dotvvmMetadata.elementsMetadata=[]),a.dotvvmMetadata.elementsMetadata.push(i)):(a.dotvvmMetadata=new DotvvmValidationObservableMetadata,a.dotvvmMetadata.elementsMetadata=[i]),s=a.dotvvmMetadata.elementsMetadata):s=new DotvvmValidationObservableMetadata,setTimeout(function(e,t){ko.utils.domNodeDisposal.addDisposeCallback(t,function(){for(var r=0,n=e;r<n.length;r++){var o=n[r];if(o.element===t){e.splice(e.indexOf(o),1);break}}})},0,s,e),dotvvm.domUtils.attachEvent(e,"change",function(){if(ko.isObservable(a)){var t,r;if("datetime"===i.dataType){var n=a();null!=n&&(n=dotvvm.globalize.parseDotvvmDate(n)),r=null==(t=dotvvm.globalize.parseDate(e.value,i.format,n))?null:dotvvm.serialization.serializeDate(t,!1)}else r=null===(t=dotvvm.globalize.parseNumber(e.value))||isNaN(t)?null:t;null==r&&null!==e.value&&""!==e.value?(e.attributes["data-invalid-value"]=e.value,e.attributes["data-dotvvm-value-type-valid"]=!1,i.elementValidationState=!1):(e.attributes["data-invalid-value"]=null,e.attributes["data-dotvvm-value-type-valid"]=!0,i.elementValidationState=!0),a()===r?a.valueHasMutated?a.valueHasMutated():a.notifySubscribers():a(r)}})},update:function(e,t,r,n,o){var a=t(),i=(e.attributes["data-dotvvm-format"]||{value:""}).value,s=ko.unwrap(a);if(i){var l=dotvvm.globalize.formatString(i,s),u=e.attributes["data-invalid-value"];if(null==u){if(e.value=l||"",a.dotvvmMetadata&&a.dotvvmMetadata.elementsMetadata)for(var d=0,v=a.dotvvmMetadata.elementsMetadata;d<v.length;d++){var c=v[d];c.element===e&&(e.attributes["data-dotvvm-value-type-valid"]=!0,c.elementValidationState=!0)}}else e.attributes["data-invalid-value"]=null,e.value=u}else e.value=s}},ko.bindingHandlers["dotvvm-textbox-select-all-on-focus"]={init:function(e,t,r,n,o){e.$selectAllOnFocusHandler=function(){e.select()}},update:function(e,t,r,n,o){!0===ko.unwrap(t())?e.addEventListener("focus",e.$selectAllOnFocusHandler):e.removeEventListener("focus",e.$selectAllOnFocusHandler)}},ko.bindingHandlers["dotvvm-CheckState"]={init:function(e,t,r,n,o){ko.getBindingHandler("checked").init(e,t,r,n,o)},update:function(e,t,r){var n=ko.unwrap(t());e.indeterminate=null==n}}},e}(),DotvvmValidationContext=function(){return function(e,t,r){this.valueToValidate=e,this.parentViewModel=t,this.parameters=r}}(),DotvvmValidationObservableMetadata=function(){return function(){}}(),DotvvmValidationElementMetadata=function(){return function(){this.elementValidationState=!0}}(),DotvvmValidatorBase=function(){function e(){}return e.prototype.isValid=function(e,t){return!1},e.prototype.isEmpty=function(e){return null==e||"string"==typeof e&&""===e.trim()},e.prototype.getValidationMetadata=function(e){return e.dotvvmMetadata},e}(),DotvvmRequiredValidator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isValid=function(e){var t=e.valueToValidate;return!this.isEmpty(t)},t}(DotvvmValidatorBase),DotvvmRegularExpressionValidator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isValid=function(e){var t=e.valueToValidate,r=e.parameters[0];return this.isEmpty(t)||new RegExp(r).test(t)},t}(DotvvmValidatorBase),DotvvmIntRangeValidator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isValid=function(e){var t=e.valueToValidate,r=e.parameters[0],n=e.parameters[1];return t%1==0&&t>=r&&t<=n},t}(DotvvmValidatorBase),DotvvmEnforceClientFormatValidator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isValid=function(e,t){var r=!0;e.parameters[0]||null!=e.valueToValidate||(r=!1),e.parameters[1]||0!==e.valueToValidate.length||(r=!1),!e.parameters[2]&&this.isEmpty(e.valueToValidate)&&(r=!1);var n=this.getValidationMetadata(t);if(n&&n.elementsMetadata)for(var o=0,a=n.elementsMetadata;o<a.length;o++){a[o].elementValidationState||(r=!1)}return r},t}(DotvvmValidatorBase),DotvvmRangeValidator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isValid=function(e,t){var r=e.valueToValidate,n=e.parameters[0],o=e.parameters[1];return r>=n&&r<=o},t}(DotvvmValidatorBase),DotvvmNotNullValidator=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.isValid=function(e){return null!==e.valueToValidate&&void 0!==e.valueToValidate},t}(DotvvmValidatorBase),ValidationError=function(){function e(e,t){this.validatedObservable=e,this.errorMessage=t}return e.getOrCreate=function(e){if(e.wrappedProperty){var t=e.wrappedProperty();ko.isObservable(t)&&(e=t)}return e.validationErrors||(e.validationErrors=ko.observableArray()),e.validationErrors},e.isValid=function(e){return!e.validationErrors||0===e.validationErrors().length},e.prototype.clear=function(e){this.validatedObservable.validationErrors.remove(this),e.errors.remove(this)},e}(),DotvvmValidation=function(){function e(e){var t=this;this.rules={required:new DotvvmRequiredValidator,regularExpression:new DotvvmRegularExpressionValidator,intrange:new DotvvmIntRangeValidator,range:new DotvvmRangeValidator,notnull:new DotvvmNotNullValidator,enforceClientFormat:new DotvvmEnforceClientFormatValidator},this.errors=ko.observableArray([]),this.events={validationErrorsChanged:new DotvvmEvent("dotvvm.validation.events.validationErrorsChanged")},this.elementUpdateFunctions={hideWhenValid:function(e,t,r){t.length>0?e.style.display="":e.style.display="none"},invalidCssClass:function(e,t,r){if(t.length>0)e.className+=" "+r;else{var n=r.split(" ");e.className=e.className.split(" ").filter(function(e){return n.indexOf(e)<0}).join(" ")}},setToolTipText:function(e,t,r){t.length>0?e.title=t.join(", "):e.title=""},showErrorMessageText:function(e,t,r){e[e.innerText?"innerText":"textContent"]=t.join(", ")}};var r=function(r){return{execute:function(n,o){if(r){o.additionalPostbackData.validationTargetPath=r;var a=ko.contextFor(o.sender),i=e.evaluator.evaluateOnViewModel(a,r);if(t.clearValidationErrors(e.viewModelObservables[o.viewModelName||"root"]),t.validateViewModel(i),t.errors().length>0)return console.log("Validation failed: postback aborted; errors: ",t.errors()),Promise.reject({type:"handler",handler:t,message:"Validation failed"});t.events.validationErrorsChanged.trigger({viewModel:o.viewModel})}return n()}}};e.postbackHandlers.validate=function(e){return r(e.path)},e.postbackHandlers["validate-root"]=function(){return r("dotvvm.viewModelObservables['root']")},e.postbackHandlers["validate-this"]=function(){return r("$data")},e.events.afterPostback.subscribe(function(e){!e.wasInterrupted&&e.serverResponseObject&&("successfulCommand"===e.serverResponseObject.action?(t.mergeValidationRules(e),e.isHandled=!0):"validationErrors"===e.serverResponseObject.action&&(t.showValidationErrorsFromServer(e),e.isHandled=!0)),t.events.validationErrorsChanged.trigger(e)}),e.events.spaNavigating.subscribe(function(r){t.clearValidationErrors(e.viewModelObservables[r.viewModelName])}),ko.bindingHandlers.dotvvmValidation={init:function(e,r,n,o,a){var i=r();if(ko.isObservable(i)){var s=n.get("dotvvmValidationOptions"),l=function(e,r){for(var n in s)s.hasOwnProperty(n)&&t.elementUpdateFunctions[n](e,r.map(function(e){return e.errorMessage}),s[n])},u=ValidationError.getOrCreate(i);u.subscribe(function(t){return l(e,t)}),l(e,u())}}}}return e.prototype.validateViewModel=function(e){if(ko.isObservable(e)&&(e=ko.unwrap(e)),e){var t=ko.unwrap(e.$type),r=(dotvvm.viewModels.root.validationRules||{})[t]||{};for(var n in e)if(e.hasOwnProperty(n)&&0!==n.indexOf("$")){var o=e[n];if(o&&ko.isObservable(o)){var a=e[n]();r.hasOwnProperty(n)&&this.validateProperty(e,o,a,r[n]);var i=e[n+"$options"];if(i&&i.type&&ValidationError.isValid(o)&&!dotvvm.serialization.validateType(a,i.type)){var s=new ValidationError(o,"The value of property "+n+" ("+a+") is invalid value for type "+i.type+".");this.addValidationError(o,s)}if(a)if(Array.isArray(a))for(var l=0,u=a;l<u.length;l++){var d=u[l];this.validateViewModel(d)}else a&&a instanceof Object&&this.validateViewModel(a)}}}},e.prototype.validateProperty=function(e,t,r,n){for(var o=0,a=n;o<a.length;o++){var i=a[o],s=this.rules[i.ruleName],l=new DotvvmValidationContext(r,e,i.parameters);if(!s.isValid(l,t)){ValidationError.getOrCreate(t);var u=new ValidationError(t,i.errorMessage);this.addValidationError(t,u)}}},e.prototype.mergeValidationRules=function(e){if(e.serverResponseObject.validationRules){var t=dotvvm.viewModels[e.viewModelName].validationRules;void 0===t&&(dotvvm.viewModels[e.viewModelName].validationRules={},t=dotvvm.viewModels[e.viewModelName].validationRules);for(var r in e.serverResponseObject.validationRules)e.serverResponseObject.validationRules.hasOwnProperty(r)&&(t[r]=e.serverResponseObject.validationRules[r])}},e.prototype.clearValidationErrors=function(e){if(e&&ko.isObservable(e)){if(e.validationErrors)for(var t=0,r=e.validationErrors();t<r.length;t++){r[t].clear(this)}var n=e();if(n){if(Array.isArray(n))for(var o=0,a=n;o<a.length;o++){var i=a[o];this.clearValidationErrors(i)}for(var s in n)if(n.hasOwnProperty(s)&&0!==s.indexOf("$")){var l=n[s];this.clearValidationErrors(l)}}}},e.prototype.getValidationErrors=function(e,t,r,n){if(void 0===n&&(n=!0),!e)return[];var o=[];if(r&&(o=o.concat(ValidationError.getOrCreate(e)())),n){var a=ko.unwrap(e);if(Array.isArray(a))for(var i=0,s=a;i<s.length;i++){var l=s[i];o=o.concat(this.getValidationErrors(l,t,!0,t))}else for(var u in a)if(a.hasOwnProperty(u)&&0!==u.indexOf("$")){var d=a[u];d&&ko.isObservable(d)&&(o=o.concat(this.getValidationErrors(d,t,!0,t)))}}return o},e.prototype.showValidationErrorsFromServer=function(e){var t=ko.contextFor(e.sender),r=dotvvm.evaluator.evaluateOnViewModel(t,e.postbackOptions.additionalPostbackData.validationTargetPath);if(r){this.clearValidationErrors(dotvvm.viewModelObservables[e.viewModelName]);for(var n=e.serverResponseObject.modelState,o=0;o<n.length;o++){var a,i=n[o].propertyPath;i?(ko.isObservable(r)&&(r=ko.unwrap(r)),a=dotvvm.evaluator.evaluateOnViewModel(r,i)):a=r;var s=new ValidationError(a,n[o].errorMessage);this.addValidationError(a,s)}}},e.prototype.addValidationError=function(e,t){ValidationError.getOrCreate(e).indexOf(t)<0&&(e.validationErrors.push(t),this.errors.push(t))},e}(),DotvvmEvaluator=function(){function DotvvmEvaluator(){}return DotvvmEvaluator.prototype.evaluateOnViewModel=function(context,expression){var result;return(result=context&&context.$data?eval("(function ($context) { with($context) { with ($data) { return "+expression+"; } } })")(context):eval("(function ($context) { var $data=$context; with($context) { return "+expression+"; } })")(context))&&result.$data&&(result=result.$data),result},DotvvmEvaluator.prototype.evaluateOnContext=function(e,t){var r=!1;for(var n in e)if(0===t.indexOf(n)){r=!0;break}return r||(t="$data."+t),this.evaluateOnViewModel(e,t)},DotvvmEvaluator.prototype.getDataSourceItems=function(e){var t=ko.unwrap(e);return void 0===t||null==t?[]:ko.unwrap(t.Items||t)},DotvvmEvaluator.prototype.tryEval=function(e){try{return e()}catch(e){return null}},DotvvmEvaluator.prototype.isObservableArray=function(e){return ko.isComputed(e)?Array.isArray(e.peek()):!!ko.isObservable(e)&&"push"in e},DotvvmEvaluator.prototype.wrapObservable=function(e,t){var r=this,n=ko.pureComputed({read:function(){return ko.unwrap(r.getExpressionResult(e))},write:function(t){return r.updateObservable(e,t)}});return t&&(n.push=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"push",t)},n.pop=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"pop",t)},n.unshift=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"unshift",t)},n.shift=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"shift",t)},n.reverse=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"reverse",t)},n.sort=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"sort",t)},n.splice=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"splice",t)},n.slice=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"slice",t)},n.replace=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"replace",t)},n.indexOf=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"indexOf",t)},n.remove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"remove",t)},n.removeAll=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return r.updateObservableArray(e,"removeAll",t)},n=n.extend({trackArrayChanges:!0})),n.extend({notify:"always"})},DotvvmEvaluator.prototype.updateObservable=function(e,t){var r=this.getExpressionResult(e);ko.isWriteableObservable(r)?r(t):console.error("Cannot write a value to ko.computed because the expression '"+e+"' does not return a writable observable.")},DotvvmEvaluator.prototype.updateObservableArray=function(e,t,r){var n=this.getExpressionResult(e);this.isObservableArray(n)?n[t].apply(n,r):console.error("Cannot execute '"+t+"' function on ko.computed because the expression '"+e+"' does not return an observable array.")},DotvvmEvaluator.prototype.getExpressionResult=function(e){var t=e();return ko.isComputed(t)&&"wrappedProperty"in t&&(t=t.wrappedProperty()),t},DotvvmEvaluator}(),DotvvmEventHub=function(){function e(){this.map={}}return e.prototype.notify=function(e){e in this.map?this.map[e].notifySubscribers():this.map[e]=ko.observable(0)},e.prototype.get=function(e){return this.map[e]||(this.map[e]=ko.observable(0))},e}();!function(){var e={};DotVVM.prototype.invokeApiFn=function(t,r,n,o){void 0===r&&(r=[]),void 0===n&&(n=[]),void 0===o&&(o=t.toString());var a=e[o]||(e[o]=ko.observable(null)),i=ko.pureComputed(function(){return a()});return i.refreshValue=function(e){var r=a.promise;a.isLoading||(a.isLoading=!0,r=function(){try{return{type:"result",result:window.Promise.resolve(ko.ignoreDependencies(t)).then(function(e){e&&(a(ko.unwrap(dotvvm.serialization.deserialize(e,a))),a.notifySubscribers());for(var t=0,r=n;t<r.length;t++){var o=r[t];dotvvm.eventHub.notify(o)}return e},console.warn)}}catch(e){return console.warn(e),{type:"error",error:e}}}(),a.promise=r);{if("error"!=r.type)return r.result.then(function(e){return a.isLoading=!1},function(e){return a.isLoading=!1}),r.result;if(a.isLoading=!1,e)throw r.error}},a.peek()||i.refreshValue(),ko.computed(function(){return r.map(function(e){return"string"==typeof e?dotvvm.eventHub.get(e)():e()})}).subscribe(function(e){return i.refreshValue()}),i},DotVVM.prototype.apiRefreshOn=function(e,t){return"function"!=typeof e.refreshValue&&console.error("The object is not refreshable"),t.subscribe(function(){"function"!=typeof e.refreshValue&&console.error("The object is not refreshable"),e.refreshValue&&e.refreshValue()}),e},DotVVM.prototype.api={},DotVVM.prototype.eventHub=new DotvvmEventHub}();